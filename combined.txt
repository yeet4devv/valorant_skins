===== index.html =====
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VALORANT Skin Showcase</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Oswald:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://valorant-api.com">
    <link rel="preconnect" href="https://media.valorant-api.com" crossorigin>
</head>
<body>
    <div id="loader" class="loader">
        <div class="loader-content">
            <div class="loader-logo">
                <svg viewBox="0 0 100 100" class="valorant-logo-svg">
                    <polygon points="50,5 95,30 95,70 50,95 5,70 5,30" fill="none" stroke="#ff4655" stroke-width="2"/>
                    <text x="50" y="58" text-anchor="middle" fill="#ff4655" font-size="24" font-family="Oswald">V</text>
                </svg>
            </div>
            <div class="loader-bar"><div class="loader-bar-fill"></div></div>
            <p class="loader-text">Loading Arsenal...</p>
        </div>
    </div>

    <div class="cursor-glow" id="cursorGlow"></div>

    <nav class="navbar" id="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <div class="logo-icon">
                    <svg viewBox="0 0 100 100" width="40" height="40">
                        <polygon points="50,5 95,30 95,70 50,95 5,70 5,30" fill="none" stroke="#ff4655" stroke-width="3"/>
                        <text x="50" y="60" text-anchor="middle" fill="#ff4655" font-size="28" font-family="Oswald" font-weight="700">V</text>
                    </svg>
                </div>
                <span class="logo-text">ARSENAL</span>
            </div>
            <div class="nav-links">
                <a href="#" class="nav-link active" data-filter="all">All Skins</a>
                <a href="#" class="nav-link" data-filter="favorites"><i class="fas fa-heart" style="font-size:12px;margin-right:4px"></i>Favorites<span class="nav-fav-count" id="navFavCount">0</span></a>
                <a href="#" class="nav-link" data-filter="melee">Melee</a>
                <a href="#" class="nav-link" data-filter="sidearm">Sidearm</a>
                <a href="#" class="nav-link" data-filter="smg">SMG</a>
                <a href="#" class="nav-link" data-filter="rifle">Rifle</a>
                <a href="#" class="nav-link" data-filter="sniper">Sniper</a>
                <a href="#" class="nav-link" data-filter="shotgun">Shotgun</a>
                <a href="#" class="nav-link" data-filter="heavy">Heavy</a>
            </div>
            <div class="nav-search">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Search skins...">
                </div>
            </div>
            <button class="mobile-menu-btn" id="mobileMenuBtn"><span></span><span></span><span></span></button>
        </div>
        <div class="mobile-menu" id="mobileMenu">
            <div class="mobile-search"><div class="search-box"><i class="fas fa-search"></i><input type="text" id="mobileSearchInput" placeholder="Search skins..."></div></div>
            <a href="#" class="mobile-link active" data-filter="all">All Skins</a>
            <a href="#" class="mobile-link" data-filter="favorites"><i class="fas fa-heart" style="font-size:12px;margin-right:4px"></i>Favorites<span class="nav-fav-count" id="mobileFavCount">0</span></a>
            <a href="#" class="mobile-link" data-filter="melee">Melee</a>
            <a href="#" class="mobile-link" data-filter="sidearm">Sidearm</a>
            <a href="#" class="mobile-link" data-filter="smg">SMG</a>
            <a href="#" class="mobile-link" data-filter="rifle">Rifle</a>
            <a href="#" class="mobile-link" data-filter="sniper">Sniper</a>
            <a href="#" class="mobile-link" data-filter="shotgun">Shotgun</a>
            <a href="#" class="mobile-link" data-filter="heavy">Heavy</a>
        </div>
    </nav>

    <section class="hero" id="hero">
        <div class="hero-particles" id="heroParticles"></div>
        <div class="hero-bg-image" id="heroFeatured"></div>
        <div class="hero-inner">
            <div class="hero-content">
                <div class="hero-badge"><span class="badge-dot"></span>VALORANT COLLECTION</div>
                <h1 class="hero-title">
                    <span class="title-line">EXPLORE THE</span>
                    <span class="title-line highlight">ULTIMATE</span>
                    <span class="title-line">SKIN ARSENAL</span>
                </h1>
                <p class="hero-description">Browse through every weapon skin in VALORANT. Discover rare collections, stunning designs, and find your next favorite skin.</p>
                <div class="hero-stats">
                    <div class="stat"><span class="stat-number" id="totalSkins">0</span><span class="stat-label">Total Skins</span></div>
                    <div class="stat-divider"></div>
                    <div class="stat"><span class="stat-number" id="totalWeapons">0</span><span class="stat-label">Weapons</span></div>
                    <div class="stat-divider"></div>
                    <div class="stat"><span class="stat-number" id="totalBundles">0</span><span class="stat-label">Collections</span></div>
                </div>
                <a href="#skins" class="hero-cta"><span>Explore Skins</span><i class="fas fa-arrow-down"></i></a>
            </div>
            <div class="scroll-indicator"><div class="mouse"><div class="mouse-wheel"></div></div><span>Scroll Down</span></div>
        </div>
    </section>

    <section class="bundles-section" id="bundles">
        <div class="section-container">
            <div class="section-header">
                <span class="section-tag">FEATURED</span>
                <h2 class="section-title">Popular Collections</h2>
                <p class="section-subtitle">Discover the most iconic weapon skin bundles in VALORANT</p>
            </div>
            <div class="bundles-carousel" id="bundlesCarousel">
                <div class="skeleton-card bundle-skeleton"><div class="skeleton skeleton-image"></div><div class="skeleton-info"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-text"></div></div></div>
                <div class="skeleton-card bundle-skeleton"><div class="skeleton skeleton-image"></div><div class="skeleton-info"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-text"></div></div></div>
                <div class="skeleton-card bundle-skeleton"><div class="skeleton skeleton-image"></div><div class="skeleton-info"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-text"></div></div></div>
                <div class="skeleton-card bundle-skeleton"><div class="skeleton skeleton-image"></div><div class="skeleton-info"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-text"></div></div></div>
            </div>
        </div>
    </section>

    <section class="skins-section" id="skins">
        <div class="section-container">
            <div class="section-header">
                <span class="section-tag">WEAPONS</span>
                <h2 class="section-title">Weapon Skins</h2>
                <p class="section-subtitle">Select a weapon to explore all available skins</p>
            </div>
            <div class="weapons-grid" id="weaponsGrid">
                <div class="skeleton-card weapon-skeleton"><div class="skeleton skeleton-weapon-image"></div><div class="skeleton-info"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-text-short"></div><div class="skeleton skeleton-badge"></div></div></div>
                <div class="skeleton-card weapon-skeleton"><div class="skeleton skeleton-weapon-image"></div><div class="skeleton-info"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-text-short"></div><div class="skeleton skeleton-badge"></div></div></div>
                <div class="skeleton-card weapon-skeleton"><div class="skeleton skeleton-weapon-image"></div><div class="skeleton-info"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-text-short"></div><div class="skeleton skeleton-badge"></div></div></div>
                <div class="skeleton-card weapon-skeleton"><div class="skeleton skeleton-weapon-image"></div><div class="skeleton-info"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-text-short"></div><div class="skeleton skeleton-badge"></div></div></div>
                <div class="skeleton-card weapon-skeleton"><div class="skeleton skeleton-weapon-image"></div><div class="skeleton-info"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-text-short"></div><div class="skeleton skeleton-badge"></div></div></div>
                <div class="skeleton-card weapon-skeleton"><div class="skeleton skeleton-weapon-image"></div><div class="skeleton-info"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-text-short"></div><div class="skeleton skeleton-badge"></div></div></div>
                <div class="skeleton-card weapon-skeleton"><div class="skeleton skeleton-weapon-image"></div><div class="skeleton-info"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-text-short"></div><div class="skeleton skeleton-badge"></div></div></div>
                <div class="skeleton-card weapon-skeleton"><div class="skeleton skeleton-weapon-image"></div><div class="skeleton-info"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-text-short"></div><div class="skeleton skeleton-badge"></div></div></div>
            </div>
        </div>
    </section>

    <div class="modal-overlay" id="modalOverlay">
        <div class="modal" id="skinModal">
            <button class="modal-close" id="modalClose"><i class="fas fa-times"></i></button>
            <div class="modal-content">
                <div class="modal-hero"><div class="modal-image-container"><img src="" alt="" id="modalImage" class="modal-image"></div></div>
                <div class="modal-info">
                    <h2 class="modal-title" id="modalTitle"></h2>
                    <p class="modal-weapon" id="modalWeapon"></p>
                    <button class="modal-favorite-btn" id="modalFavoriteBtn"><i class="far fa-heart"></i><span>Add to Favorites</span></button>
                    <div class="modal-video-section" id="modalVideoSection">
                        <h3>Preview</h3>
                        <div class="video-player" id="videoPlayer">
                            <video id="videoElement" preload="metadata" playsinline><source id="videoSource" src="" type="video/mp4"></video>
                            <div class="video-overlay" id="videoOverlay"><button class="video-play-btn" id="videoPlayBtn"><i class="fas fa-play"></i></button><p class="video-hint">Click to play preview</p></div>
                            <div class="video-controls" id="videoControls">
                                <button class="video-ctrl-btn" id="videoCtrlPlay"><i class="fas fa-play"></i></button>
                                <div class="video-progress" id="videoProgress"><div class="video-progress-filled" id="videoProgressFilled"></div><div class="video-progress-handle" id="videoProgressHandle"></div></div>
                                <span class="video-time" id="videoTime">0:00 / 0:00</span>
                                <button class="video-ctrl-btn" id="videoCtrlMute"><i class="fas fa-volume-up"></i></button>
                                <button class="video-ctrl-btn" id="videoCtrlFullscreen"><i class="fas fa-expand"></i></button>
                            </div>
                            <div class="video-loading" id="videoLoading"><div class="video-spinner"></div></div>
                        </div>
                        <div class="video-level-tabs" id="videoLevelTabs"></div>
                    </div>
                    <div class="modal-chromas" id="modalChromas"><h3>Chromas</h3><div class="chromas-grid" id="chromasGrid"></div></div>
                    <div class="modal-levels" id="modalLevels"><h3>Levels</h3><div class="levels-list" id="levelsList"></div></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="weaponModalOverlay">
        <div class="weapon-modal" id="weaponModal">
            <button class="modal-close" id="weaponModalClose"><i class="fas fa-times"></i></button>
            <div class="weapon-modal-header"><img src="" alt="" id="weaponModalImage" class="weapon-modal-img"><h2 id="weaponModalTitle"></h2></div>
            <div class="weapon-skins-grid" id="weaponSkinsGrid"></div>
        </div>
    </div>

    <button class="back-to-top" id="backToTop"><i class="fas fa-chevron-up"></i></button>

    <footer class="footer">
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-logo">
                    <svg viewBox="0 0 100 100" width="50" height="50"><polygon points="50,5 95,30 95,70 50,95 5,70 5,30" fill="none" stroke="#ff4655" stroke-width="3"/><text x="50" y="60" text-anchor="middle" fill="#ff4655" font-size="28" font-family="Oswald" font-weight="700">V</text></svg>
                    <span>ARSENAL</span>
                </div>
                <p class="footer-text">This is a fan-made project. VALORANT is a registered trademark of Riot Games. All skin images and data are property of Riot Games.</p>
                <p class="footer-credit">Powered by <a href="https://valorant-api.com" target="_blank">valorant-api.com</a></p>
            </div>
        </div>
    </footer>

    <script src="js/app.js"></script>
</body>
</html>

===== js/app.js =====
// ===== VALORANT SKIN SHOWCASE APP =====

const API_BASE = 'https://valorant-api.com/v1';

const state = {
    weapons: [],
    bundles: [],
    allSkins: 0,
    currentFilter: 'all',
    searchQuery: '',
    loadError: null,
    favorites: JSON.parse(localStorage.getItem('valorant_favorites') || '[]'),
};

const $ = (s) => document.querySelector(s);
const $$ = (s) => document.querySelectorAll(s);

async function fetchData(endpoint) {
    const res = await fetch(`${API_BASE}${endpoint}`);
    if (!res.ok) throw new Error(`HTTP ${res.status}: ${res.statusText}`);
    const data = await res.json();
    if (!data.data) throw new Error('Invalid API response');
    return data.data;
}

function animateNumber(el, target, dur = 1500) {
    let s = 0;
    const step = (t) => { if (!s) s = t; const p = Math.min((t - s) / dur, 1); el.textContent = Math.floor((1 - Math.pow(1 - p, 3)) * target); if (p < 1) requestAnimationFrame(step); };
    requestAnimationFrame(step);
}

function debounce(fn, d) { let t; return function (...a) { clearTimeout(t); t = setTimeout(() => fn.apply(this, a), d); }; }

// ===== FAVORITES =====
function saveFavorites() {
    localStorage.setItem('valorant_favorites', JSON.stringify(state.favorites));
    updateFavoriteCounts();
}

function isFavorite(skinUuid) {
    return state.favorites.includes(skinUuid);
}

function toggleFavorite(skinUuid) {
    const idx = state.favorites.indexOf(skinUuid);
    if (idx > -1) {
        state.favorites.splice(idx, 1);
    } else {
        state.favorites.push(skinUuid);
    }
    saveFavorites();
    return isFavorite(skinUuid);
}

function updateFavoriteCounts() {
    const count = state.favorites.length;
    const navCount = $('#navFavCount');
    const mobileCount = $('#mobileFavCount');

    [navCount, mobileCount].forEach(el => {
        if (!el) return;
        el.textContent = count;
        el.classList.toggle('visible', count > 0);
        // Bump animation
        el.classList.remove('bump');
        void el.offsetWidth; // force reflow
        el.classList.add('bump');
    });
}

function createFavoriteButton(skinUuid, size = 'normal') {
    const isActive = isFavorite(skinUuid);
    const iconClass = isActive ? 'fas fa-heart' : 'far fa-heart';
    return `
        <button class="favorite-btn ${isActive ? 'active' : ''}" data-fav-skin="${skinUuid}" title="${isActive ? 'Remove from favorites' : 'Add to favorites'}">
            <i class="${iconClass}"></i>
            <div class="fav-burst"><span></span><span></span><span></span><span></span><span></span><span></span></div>
        </button>
    `;
}

function initFavoriteHandlers() {
    // Delegated click handler for all favorite buttons
    document.addEventListener('click', (e) => {
        const btn = e.target.closest('.favorite-btn');
        if (!btn) return;

        e.stopPropagation(); // Don't trigger card click
        e.preventDefault();

        const skinUuid = btn.dataset.favSkin;
        const nowFav = toggleFavorite(skinUuid);

        // Update this button
        btn.classList.toggle('active', nowFav);
        btn.querySelector('i').className = nowFav ? 'fas fa-heart' : 'far fa-heart';
        btn.title = nowFav ? 'Remove from favorites' : 'Add to favorites';

        // Burst effect
        if (nowFav) {
            btn.classList.remove('burst');
            void btn.offsetWidth;
            btn.classList.add('burst');
            setTimeout(() => btn.classList.remove('burst'), 600);
        }

        // Sync all other buttons with the same skin UUID
        $$(`[data-fav-skin="${skinUuid}"]`).forEach(otherBtn => {
            if (otherBtn !== btn) {
                otherBtn.classList.toggle('active', nowFav);
                otherBtn.querySelector('i').className = nowFav ? 'fas fa-heart' : 'far fa-heart';
                otherBtn.title = nowFav ? 'Remove from favorites' : 'Add to favorites';
            }
        });

        // Sync modal favorite button
        const modalFavBtn = $('#modalFavoriteBtn');
        if (modalFavBtn && modalFavBtn.dataset.favSkin === skinUuid) {
            modalFavBtn.classList.toggle('active', nowFav);
            modalFavBtn.querySelector('i').className = nowFav ? 'fas fa-heart' : 'far fa-heart';
            modalFavBtn.querySelector('span').textContent = nowFav ? 'Remove from Favorites' : 'Add to Favorites';
        }

        // Show toast
        showToast(nowFav ? 'Added to favorites' : 'Removed from favorites', nowFav ? 'success' : 'error', 1500);

        // If viewing favorites filter and removed, re-render
        if (!nowFav && state.currentFilter === 'favorites') {
            renderWeapons();
        }
    });

    // Modal favorite button
    document.addEventListener('click', (e) => {
        const btn = e.target.closest('#modalFavoriteBtn');
        if (!btn) return;

        const skinUuid = btn.dataset.favSkin;
        if (!skinUuid) return;

        const nowFav = toggleFavorite(skinUuid);

        btn.classList.toggle('active', nowFav);
        btn.querySelector('i').className = nowFav ? 'fas fa-heart' : 'far fa-heart';
        btn.querySelector('span').textContent = nowFav ? 'Remove from Favorites' : 'Add to Favorites';

        // Sync card buttons
        $$(`[data-fav-skin="${skinUuid}"]`).forEach(otherBtn => {
            otherBtn.classList.toggle('active', nowFav);
            otherBtn.querySelector('i').className = nowFav ? 'fas fa-heart' : 'far fa-heart';
        });

        showToast(nowFav ? 'Added to favorites' : 'Removed from favorites', nowFav ? 'success' : 'error', 1500);
    });

    // Initialize counts
    updateFavoriteCounts();
}

// Find a skin by UUID across all weapons
function findSkinByUuid(uuid) {
    for (const weapon of state.weapons) {
        if (!weapon.skins) continue;
        const skin = weapon.skins.find(s => s.uuid === uuid);
        if (skin) return { skin, weaponName: weapon.displayName };
    }
    return null;
}

// ===== TOAST =====
function showToast(msg, type = 'success', dur = 3000) {
    const existing = $('.toast');
    if (existing) existing.remove();
    const t = document.createElement('div');
    t.className = `toast ${type}`;
    t.innerHTML = `<i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i><span>${msg}</span>`;
    document.body.appendChild(t);
    requestAnimationFrame(() => requestAnimationFrame(() => t.classList.add('visible')));
    setTimeout(() => { t.classList.remove('visible'); setTimeout(() => t.remove(), 400); }, dur);
}

// ===== ERROR STATE =====
function generateErrorHTML(target, errorMsg) {
    return `<div class="error-state" data-error-target="${target}"><div class="error-icon"><i class="fas fa-exclamation-triangle"></i></div><h3>Failed to Load ${target === 'weapons' ? 'Weapons' : 'Collections'}</h3><p>We couldn't connect to the VALORANT API. Check your connection and try again.</p><button class="error-retry-btn" data-retry="${target}"><i class="fas fa-redo"></i><span>Retry</span></button>${errorMsg ? `<div class="error-details">${errorMsg}</div>` : ''}</div>`;
}

// ===== SKELETONS =====
function generateWeaponSkeletons(n = 8) {
    let h = '';
    for (let i = 0; i < n; i++) h += `<div class="skeleton-card weapon-skeleton"><div class="skeleton skeleton-weapon-image"></div><div class="skeleton-info"><div class="skeleton skeleton-title"></div><div class="skeleton skeleton-text-short"></div><div class="skeleton skeleton-badge"></div></div></div>`;
    return h;
}
function generateSkinSkeletons(n = 8) {
    let h = '';
    for (let i = 0; i < n; i++) h += `<div class="skeleton-card skin-skeleton"><div class="skeleton skeleton-skin-image"></div><div class="skeleton-info"><div class="skeleton skeleton-skin-title"></div><div class="skeleton skeleton-skin-tier"></div></div></div>`;
    return h;
}

// ===== CURSOR GLOW =====
function initCursorGlow() { const g = $('#cursorGlow'); document.addEventListener('mousemove', (e) => { g.style.left = e.clientX + 'px'; g.style.top = e.clientY + 'px'; }); }

// ===== PARTICLES =====
function initParticles() { const c = $('#heroParticles'); for (let i = 0; i < 40; i++) { const p = document.createElement('div'); p.className = 'particle'; p.style.left = Math.random()*100+'%'; p.style.animationDelay = Math.random()*4+'s'; p.style.animationDuration = (3+Math.random()*3)+'s'; p.style.width = (1+Math.random()*3)+'px'; p.style.height = p.style.width; c.appendChild(p); } }

// ===== 3D TILT =====
function initTiltEffect() {
    let active = null, raf = null, mouse = { x: 0, y: 0 }; const MAX = 12, GL = 0.15;
    const gc = (t) => t.closest('.weapon-card,.skin-card,.bundle-card');
    const eg = (c) => { if (!c.querySelector('.tilt-glare')) { const g = document.createElement('div'); g.className = 'tilt-glare'; c.appendChild(g); } };
    function ap(c, mx, my) { const r = c.getBoundingClientRect(); const nx = Math.max(-1, Math.min(1, ((mx-r.left)/r.width)*2-1)); const ny = Math.max(-1, Math.min(1, ((my-r.top)/r.height)*2-1)); c.style.transform = `perspective(800px) rotateX(${-ny*MAX}deg) rotateY(${nx*MAX}deg) scale3d(1.03,1.03,1.03)`; const img = c.querySelector('.weapon-card-image,.skin-card-image,.bundle-image'); if(img) img.style.transform = `translateX(${nx*8}px) translateY(${ny*8}px) scale(1.08)`; const gl = c.querySelector('.tilt-glare'); if(gl){gl.style.background=`radial-gradient(circle at ${((mx-r.left)/r.width)*100}% ${((my-r.top)/r.height)*100}%, rgba(255,255,255,${GL}), transparent 60%)`;gl.style.opacity='1';} }
    function rs(c) { c.style.transform='';c.style.transition='transform 0.5s cubic-bezier(0.4,0,0.2,1)'; const img=c.querySelector('.weapon-card-image,.skin-card-image,.bundle-image');if(img){img.style.transform='';img.style.transition='transform 0.5s cubic-bezier(0.4,0,0.2,1)';} const gl=c.querySelector('.tilt-glare');if(gl)gl.style.opacity='0'; setTimeout(()=>{if(c!==active){c.style.transition='';if(img)img.style.transition='';}},500); }
    function loop(){if(active)ap(active,mouse.x,mouse.y);raf=requestAnimationFrame(loop);}
    document.addEventListener('mousemove',(e)=>{mouse.x=e.clientX;mouse.y=e.clientY;const c=gc(e.target);if(c&&c!==active){if(active)rs(active);active=c;eg(c);c.style.transition='none';const img=c.querySelector('.weapon-card-image,.skin-card-image,.bundle-image');if(img)img.style.transition='none';}else if(!c&&active){rs(active);active=null;}});
    document.addEventListener('mouseleave',()=>{if(active){rs(active);active=null;}});
    raf=requestAnimationFrame(loop); window.addEventListener('touchstart',()=>cancelAnimationFrame(raf),{once:true});
}

// ===== GLOW BORDER =====
function initGlowBorder() {
    let active=null;const gc=(t)=>t.closest('.weapon-card,.skin-card,.bundle-card');
    function en(c){if(!c.querySelector('.glow-border')){const b=document.createElement('div');b.className='glow-border';c.insertBefore(b,c.firstChild);const s=document.createElement('div');s.className='glow-border-shadow';c.insertBefore(s,c.firstChild);}}
    function on(c){en(c);c.querySelector('.glow-border')?.classList.add('active');c.querySelector('.glow-border-shadow')?.classList.add('active');}
    function off(c){c.querySelector('.glow-border')?.classList.remove('active');c.querySelector('.glow-border-shadow')?.classList.remove('active');}
    document.addEventListener('mousemove',(e)=>{const c=gc(e.target);if(c&&c!==active){if(active)off(active);active=c;on(c);}else if(!c&&active){off(active);active=null;}});
    document.addEventListener('mouseleave',()=>{if(active){off(active);active=null;}});
    window.addEventListener('touchstart',()=>{if(active){off(active);active=null;}},{once:true});
}

// ===== VIDEO PLAYER =====
function initVideoPlayer() {
    const video=$('#videoElement'),player=$('#videoPlayer'),overlay=$('#videoOverlay'),playBtn=$('#videoPlayBtn'),controls=$('#videoControls'),ctrlPlay=$('#videoCtrlPlay'),progress=$('#videoProgress'),filled=$('#videoProgressFilled'),handle=$('#videoProgressHandle'),timeEl=$('#videoTime'),ctrlMute=$('#videoCtrlMute'),ctrlFs=$('#videoCtrlFullscreen'),loading=$('#videoLoading');
    let isDrag=false,hideT=null;
    function fmt(s){if(isNaN(s))return'0:00';return`${Math.floor(s/60)}:${Math.floor(s%60).toString().padStart(2,'0')}`;}
    function upd(){if(!video.duration)return;const p=(video.currentTime/video.duration)*100;filled.style.width=p+'%';handle.style.left=`calc(${p}% - 6px)`;timeEl.textContent=`${fmt(video.currentTime)} / ${fmt(video.duration)}`;}
    function toggle(){video.paused?video.play():video.pause();}
    function upIcon(){ctrlPlay.innerHTML=`<i class="fas ${video.paused?'fa-play':'fa-pause'}"></i>`;player.classList.toggle('playing',!video.paused);}
    function seek(e){const r=progress.getBoundingClientRect();const cx=e.clientX??e.touches?.[0]?.clientX??0;video.currentTime=Math.max(0,Math.min(1,(cx-r.left)/r.width))*video.duration;upd();}
    function showC(){controls.classList.add('force-show');clearTimeout(hideT);hideT=setTimeout(()=>{if(!video.paused)controls.classList.remove('force-show');},3000);}
    playBtn.addEventListener('click',(e)=>{e.stopPropagation();overlay.classList.add('hidden');video.play();});
    player.addEventListener('click',(e)=>{if(e.target.closest('.video-controls,.video-overlay'))return;if(overlay.classList.contains('hidden')){toggle();showC();}});
    ctrlPlay.addEventListener('click',(e)=>{e.stopPropagation();toggle();showC();});
    ctrlMute.addEventListener('click',(e)=>{e.stopPropagation();video.muted=!video.muted;ctrlMute.innerHTML=`<i class="fas ${video.muted?'fa-volume-mute':'fa-volume-up'}"></i>`;});
    ctrlFs.addEventListener('click',(e)=>{e.stopPropagation();document.fullscreenElement?document.exitFullscreen():(player.requestFullscreen?.()??player.webkitRequestFullscreen?.());});
    progress.addEventListener('mousedown',(e)=>{e.stopPropagation();isDrag=true;progress.classList.add('dragging');seek(e);});
    document.addEventListener('mousemove',(e)=>{if(isDrag)seek(e);});document.addEventListener('mouseup',()=>{if(isDrag){isDrag=false;progress.classList.remove('dragging');}});
    progress.addEventListener('touchstart',(e)=>{isDrag=true;progress.classList.add('dragging');seek(e);},{passive:true});
    document.addEventListener('touchmove',(e)=>{if(isDrag)seek(e);},{passive:true});document.addEventListener('touchend',()=>{if(isDrag){isDrag=false;progress.classList.remove('dragging');}});
    video.addEventListener('timeupdate',upd);video.addEventListener('play',upIcon);video.addEventListener('pause',upIcon);video.addEventListener('ended',()=>{upIcon();controls.classList.add('force-show');});
    video.addEventListener('waiting',()=>loading.classList.add('visible'));video.addEventListener('canplay',()=>loading.classList.remove('visible'));video.addEventListener('loadedmetadata',()=>{upd();loading.classList.remove('visible');});
    player.addEventListener('mousemove',showC);
    player.addEventListener('dblclick',(e)=>{if(e.target.closest('.video-controls'))return;document.fullscreenElement?document.exitFullscreen():(player.requestFullscreen?.()??player.webkitRequestFullscreen?.());});
    player.setAttribute('tabindex','0');
    player.addEventListener('keydown',(e)=>{if(!overlay.classList.contains('hidden'))return;switch(e.key){case' ':case'k':e.preventDefault();toggle();showC();break;case'ArrowRight':e.preventDefault();video.currentTime=Math.min(video.duration,video.currentTime+5);showC();break;case'ArrowLeft':e.preventDefault();video.currentTime=Math.max(0,video.currentTime-5);showC();break;case'm':video.muted=!video.muted;ctrlMute.innerHTML=`<i class="fas ${video.muted?'fa-volume-mute':'fa-volume-up'}"></i>`;break;case'f':document.fullscreenElement?document.exitFullscreen():player.requestFullscreen?.();break;}});
}
function loadVideo(url){const v=$('#videoElement'),s=$('#videoSource'),o=$('#videoOverlay'),l=$('#videoLoading'),c=$('#videoControls'),f=$('#videoProgressFilled'),h=$('#videoProgressHandle'),t=$('#videoTime'),p=$('#videoPlayer');v.pause();o.classList.remove('hidden');l.classList.remove('visible');c.classList.remove('force-show');p.classList.remove('playing');f.style.width='0%';h.style.left='-6px';t.textContent='0:00 / 0:00';s.src=url;v.load();}

// ===== NAVBAR =====
function initNavbar() {
    const navbar=$('#navbar'),mBtn=$('#mobileMenuBtn'),mMenu=$('#mobileMenu');
    window.addEventListener('scroll',()=>{navbar.classList.toggle('scrolled',window.scrollY>50);$('#backToTop').classList.toggle('visible',window.scrollY>500);});
    mBtn.addEventListener('click',()=>{mBtn.classList.toggle('active');mMenu.classList.toggle('active');});

    $$('.nav-link').forEach(l=>{l.addEventListener('click',(e)=>{e.preventDefault();$$('.nav-link').forEach(x=>x.classList.remove('active'));l.classList.add('active');state.currentFilter=l.dataset.filter;renderWeapons();});});
    $$('.mobile-link').forEach(l=>{l.addEventListener('click',(e)=>{e.preventDefault();$$('.mobile-link').forEach(x=>x.classList.remove('active'));l.classList.add('active');$$('.nav-link').forEach(x=>x.classList.toggle('active',x.dataset.filter===l.dataset.filter));state.currentFilter=l.dataset.filter;mBtn.classList.remove('active');mMenu.classList.remove('active');renderWeapons();});});

    const exec=debounce((v)=>{state.searchQuery=v.toLowerCase().trim();renderWeapons();},250);
    const dI=$('#searchInput'),mI=$('#mobileSearchInput');
    dI.addEventListener('input',(e)=>{const v=e.target.value;mI.value=v;dI.classList.toggle('has-value',v.length>0);exec(v);});
    mI.addEventListener('input',(e)=>{const v=e.target.value;dI.value=v;mI.classList.toggle('has-value',v.length>0);exec(v);});
    const cs=(i,o)=>{i.addEventListener('keydown',(e)=>{if(e.key==='Escape'&&i.value.length>0){e.stopPropagation();i.value='';o.value='';i.classList.remove('has-value');state.searchQuery='';renderWeapons();}});};
    cs(dI,mI);cs(mI,dI);
    $('#backToTop').addEventListener('click',()=>window.scrollTo({top:0,behavior:'smooth'}));
}

function getWeaponCategory(c){if(!c)return'other';const l=c.toLowerCase();if(l.includes('melee'))return'melee';if(l.includes('sidearm')||l.includes('pistol'))return'sidearm';if(l.includes('smg')||l.includes('submachine'))return'smg';if(l.includes('rifle')||l.includes('assault'))return'rifle';if(l.includes('sniper'))return'sniper';if(l.includes('shotgun'))return'shotgun';if(l.includes('heavy')||l.includes('machine'))return'heavy';return'other';}

function createStaggerObserver(sel){let q=[],t=null;const flush=()=>{q.forEach((c,i)=>{const con=document.querySelector(sel);let cols=1;if(con){const s=getComputedStyle(con).getPropertyValue('grid-template-columns');if(s&&s!=='none')cols=s.split(' ').length;}const d=Math.floor(i/cols)*120+(i%cols)*60;c.style.transitionDelay=`${d}ms`;c.classList.add('visible');setTimeout(()=>c.style.transitionDelay='',d+600);});q=[];};return new IntersectionObserver((entries)=>{entries.forEach(e=>{if(e.isIntersecting){q.push(e.target);e.target&&e.target.parentNode;}});clearTimeout(t);t=setTimeout(flush,50);},{threshold:0.05,rootMargin:'0px 0px -40px 0px'});}

// Fix stagger
function createStaggerObserver(containerSelector){let rq=[],rt=null;const fq=()=>{rq.forEach((card,i)=>{const con=document.querySelector(containerSelector);let cols=1;if(con){const t=getComputedStyle(con).getPropertyValue('grid-template-columns');if(t&&t!=='none')cols=t.split(' ').length;}const d=Math.floor(i/cols)*120+(i%cols)*60;card.style.transitionDelay=`${d}ms`;card.classList.add('visible');setTimeout(()=>card.style.transitionDelay='',d+600);});rq=[];};return new IntersectionObserver((entries)=>{entries.forEach(e=>{if(e.isIntersecting){rq.push(e.target);e.target.closest&&0;/*unobserve handled below*/}});clearTimeout(rt);rt=setTimeout(fq,50);},{threshold:0.05,rootMargin:'0px 0px -40px 0px'});}

// ===== RETRY =====
function initRetryHandlers(){document.addEventListener('click',async(e)=>{const btn=e.target.closest('.error-retry-btn');if(!btn)return;const target=btn.dataset.retry;btn.classList.add('loading');btn.querySelector('i').className='fas fa-spinner';btn.querySelector('span').textContent='Retrying...';try{if(target==='weapons'||target==='all'){const w=await fetchData('/weapons');state.weapons=w||[];let sc=0;state.weapons.forEach(w=>{if(w.skins)sc+=w.skins.filter(s=>s.displayIcon&&!s.displayName.toLowerCase().includes('standard')&&!s.displayName.toLowerCase().includes('random')).length;});state.allSkins=sc;animateNumber($('#totalSkins'),sc);animateNumber($('#totalWeapons'),state.weapons.length);setHeroFeatured();renderWeapons();}if(target==='bundles'||target==='all'){const b=await fetchData('/bundles');state.bundles=(b||[]).filter(b=>b.displayIcon);animateNumber($('#totalBundles'),state.bundles.length);renderBundles();}state.loadError=null;showToast('Data loaded successfully!','success');}catch(err){console.error('Retry failed:',err);btn.classList.remove('loading');btn.querySelector('i').className='fas fa-redo';btn.querySelector('span').textContent='Retry';showToast('Retry failed â€” please try again','error');}});}

// ===== LOAD DATA =====
async function loadData(){let wErr=null,bErr=null;try{state.weapons=await fetchData('/weapons')||[];}catch(e){console.error('Failed:',e);wErr=e.message;state.weapons=[];}try{state.bundles=(await fetchData('/bundles')||[]).filter(b=>b.displayIcon);}catch(e){console.error('Failed:',e);bErr=e.message;state.bundles=[];}
let sc=0;state.weapons.forEach(w=>{if(w.skins)sc+=w.skins.filter(s=>s.displayIcon&&!s.displayName.toLowerCase().includes('standard')&&!s.displayName.toLowerCase().includes('random')).length;});state.allSkins=sc;
setTimeout(()=>$('#loader').classList.add('hidden'),2000);
setTimeout(()=>{animateNumber($('#totalSkins'),sc);animateNumber($('#totalWeapons'),state.weapons.length);animateNumber($('#totalBundles'),state.bundles.length);},2200);
if(wErr&&bErr){state.loadError='all';$('#bundlesCarousel').innerHTML=generateErrorHTML('bundles',bErr);$('#weaponsGrid').innerHTML=generateErrorHTML('weapons',wErr);}else{bErr?$('#bundlesCarousel').innerHTML=generateErrorHTML('bundles',bErr):renderBundles();if(wErr){$('#weaponsGrid').innerHTML=generateErrorHTML('weapons',wErr);}else{setHeroFeatured();renderWeapons();}}
updateFavoriteCounts();}

function setHeroFeatured(){const c=$('#heroFeatured');const w=state.weapons.find(w=>w.displayName==='Vandal')||state.weapons[5];if(w?.skins){const s=w.skins.find(s=>s.displayIcon&&!s.displayName.toLowerCase().includes('standard'));if(s?.displayIcon)c.innerHTML=`<img src="${s.displayIcon}" alt="${s.displayName}">`;}}

function renderBundles(){const c=$('#bundlesCarousel');const f=state.bundles.slice(0,8);if(!f.length){c.innerHTML=generateErrorHTML('bundles','No bundle data');return;}c.innerHTML=f.map((b,i)=>`<div class="bundle-card" style="animation:fadeInUp 0.5s ease ${i*0.1}s forwards;opacity:0;"><img src="${b.displayIcon}" alt="${b.displayName}" class="bundle-image" loading="lazy" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 300 180%22><rect fill=%22%2316161f%22 width=%22300%22 height=%22180%22/><text x=%22150%22 y=%2295%22 fill=%22%234a4a5e%22 text-anchor=%22middle%22 font-size=%2214%22>No Image</text></svg>'"><div class="bundle-info"><h3 class="bundle-name">${b.displayName}</h3><div class="bundle-meta"><i class="fas fa-layer-group"></i><span>Collection Bundle</span></div></div></div>`).join('');}

function renderWeapons(){
    const container=$('#weaponsGrid');

    // Favorites filter â€” show individual skins, not weapons
    if(state.currentFilter==='favorites'){
        renderFavorites(container);
        return;
    }

    let weapons=[...state.weapons];
    if(!weapons.length&&!state.loadError){container.innerHTML=generateWeaponSkeletons(8);return;}
    if(!weapons.length&&state.loadError){if(!container.querySelector('.error-state'))container.innerHTML=generateErrorHTML('weapons','No weapon data');return;}

    if(state.currentFilter!=='all')weapons=weapons.filter(w=>{const cat=w.shopData?.categoryText||w.category?.replace('EEquippableCategory::','')||'';return getWeaponCategory(cat)===state.currentFilter;});
    if(state.searchQuery)weapons=weapons.filter(w=>w.displayName.toLowerCase().includes(state.searchQuery)||w.skins?.some(s=>s.displayName.toLowerCase().includes(state.searchQuery)));
    if(!weapons.length){container.innerHTML=`<div class="no-results"><i class="fas fa-search"></i><h3>No weapons found</h3><p>Try a different search or filter</p></div>`;return;}

    container.innerHTML=weapons.map(w=>{const sc=w.skins?w.skins.filter(s=>s.displayIcon&&!s.displayName.toLowerCase().includes('standard')&&!s.displayName.toLowerCase().includes('random')).length:0;const cat=w.shopData?.categoryText||w.category?.replace('EEquippableCategory::','')||'Weapon';const img=w.displayIcon||w.killStreamIcon||'';return`<div class="weapon-card" data-weapon-id="${w.uuid}"><img src="${img}" alt="${w.displayName}" class="weapon-card-image" loading="lazy" onerror="this.style.display='none'"><div class="weapon-card-info"><h3 class="weapon-card-name">${w.displayName}</h3><p class="weapon-card-category">${cat}</p><div class="weapon-card-count"><i class="fas fa-paint-brush"></i>${sc} skins</div></div></div>`;}).join('');

    const obs=createStaggerObserver('#weaponsGrid');
    $$('.weapon-card').forEach(card=>{obs.observe(card);card.addEventListener('click',()=>{const w=state.weapons.find(w=>w.uuid===card.dataset.weaponId);if(w)openWeaponModal(w);});});
}

// ===== RENDER FAVORITES =====
function renderFavorites(container) {
    if (state.favorites.length === 0) {
        container.innerHTML = `
            <div class="favorites-empty">
                <i class="far fa-heart"></i>
                <h3>No Favorites Yet</h3>
                <p>Click the heart icon on any skin to add it to your favorites collection. Your picks are saved locally.</p>
            </div>
        `;
        return;
    }

    // Gather favorite skins
    const favSkins = [];
    for (const uuid of state.favorites) {
        const result = findSkinByUuid(uuid);
        if (result) favSkins.push(result);
    }

    if (favSkins.length === 0) {
        container.innerHTML = `
            <div class="favorites-empty">
                <i class="far fa-heart"></i>
                <h3>No Favorites Yet</h3>
                <p>Your favorited skins will appear here once weapon data loads.</p>
            </div>
        `;
        return;
    }

    // Filter by search
    let filtered = favSkins;
    if (state.searchQuery) {
        filtered = favSkins.filter(f =>
            f.skin.displayName.toLowerCase().includes(state.searchQuery) ||
            f.weaponName.toLowerCase().includes(state.searchQuery)
        );
    }

    if (filtered.length === 0) {
        container.innerHTML = `<div class="no-results"><i class="fas fa-search"></i><h3>No matching favorites</h3><p>Try a different search term</p></div>`;
        return;
    }

    container.innerHTML = filtered.map(({ skin, weaponName }) => {
        const tier = skin.contentTierUuid ? getTierInfo(skin.contentTierUuid) : null;
        const img = skin.displayIcon || '';
        return `
            <div class="weapon-card is-favorite" data-fav-click-skin="${skin.uuid}" data-fav-click-weapon="${weaponName}">
                ${createFavoriteButton(skin.uuid)}
                <img src="${img}" alt="${skin.displayName}" class="weapon-card-image" loading="lazy" onerror="this.style.display='none'">
                <div class="weapon-card-info">
                    <h3 class="weapon-card-name">${skin.displayName}</h3>
                    <p class="weapon-card-category">${weaponName}</p>
                    ${tier ? `<div class="weapon-card-count"><img src="${tier.icon}" class="tier-icon" alt="" style="width:14px;height:14px;margin-right:2px">${tier.name}</div>` : ''}
                </div>
            </div>
        `;
    }).join('');

    // Stagger animation
    const obs = createStaggerObserver('#weaponsGrid');
    $$('.weapon-card').forEach(card => {
        obs.observe(card);
        card.addEventListener('click', (e) => {
            if (e.target.closest('.favorite-btn')) return;
            const skinUuid = card.dataset.favClickSkin;
            const weaponName = card.dataset.favClickWeapon;
            if (skinUuid) {
                const result = findSkinByUuid(skinUuid);
                if (result) openSkinModal(result.skin, result.weaponName);
            }
        });
    });
}

// ===== WEAPON MODAL =====
function openWeaponModal(weapon){
    const overlay=$('#weaponModalOverlay');$('#weaponModalImage').src=weapon.displayIcon||weapon.killStreamIcon||'';$('#weaponModalTitle').textContent=weapon.displayName;
    const grid=$('#weaponSkinsGrid');const skins=(weapon.skins||[]).filter(s=>s.displayIcon&&!s.displayName.toLowerCase().includes('random'));
    grid.innerHTML=generateSkinSkeletons(skins.length||6);overlay.classList.add('active');document.body.style.overflow='hidden';
    setTimeout(()=>{grid.innerHTML=skins.map(skin=>{const tier=skin.contentTierUuid?getTierInfo(skin.contentTierUuid):null;return`<div class="skin-card" data-skin-id="${skin.uuid}">${createFavoriteButton(skin.uuid)}<img src="${skin.displayIcon}" alt="${skin.displayName}" class="skin-card-image" loading="lazy" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 200 80%22><rect fill=%22%2316161f%22 width=%22200%22 height=%2280%22/><text x=%22100%22 y=%2245%22 fill=%22%234a4a5e%22 text-anchor=%22middle%22 font-size=%2212%22>No Preview</text></svg>'"><p class="skin-card-name">${skin.displayName}</p>${tier?`<div class="skin-card-tier"><img src="${tier.icon}" class="tier-icon" alt=""><span>${tier.name}</span></div>`:''}</div>`;}).join('');
    grid.querySelectorAll('.skin-card').forEach((card,i)=>{card.classList.add('skin-card-hidden');const t=getComputedStyle(grid).getPropertyValue('grid-template-columns');let cols=1;if(t&&t!=='none')cols=t.split(' ').length;const d=Math.floor(i/cols)*100+(i%cols)*50;setTimeout(()=>{card.classList.remove('skin-card-hidden');card.classList.add('skin-card-visible');},50+d);card.addEventListener('click',(e)=>{if(e.target.closest('.favorite-btn'))return;const s=skins.find(s=>s.uuid===card.dataset.skinId);if(s){closeWeaponModal();setTimeout(()=>openSkinModal(s,weapon.displayName),300);}});});},300);
}

function closeWeaponModal(){$('#weaponModalOverlay').classList.remove('active');document.body.style.overflow='';}

function getTierInfo(uuid){const t={'12683d76-48d7-84a3-4e09-6985571f8f36':{name:'Select',icon:'https://media.valorant-api.com/contenttiers/12683d76-48d7-84a3-4e09-6985571f8f36/displayicon.png'},'0cebb8be-46d7-c12a-d306-e9907bfc5a25':{name:'Deluxe',icon:'https://media.valorant-api.com/contenttiers/0cebb8be-46d7-c12a-d306-e9907bfc5a25/displayicon.png'},'60bca009-4182-7998-dee7-b8a2558dc369':{name:'Premium',icon:'https://media.valorant-api.com/contenttiers/60bca009-4182-7998-dee7-b8a2558dc369/displayicon.png'},'e046854e-406c-37f4-6607-19a9ba8426fc':{name:'Ultra',icon:'https://media.valorant-api.com/contenttiers/e046854e-406c-37f4-6607-19a9ba8426fc/displayicon.png'},'411e4a55-4e59-7757-41f0-86a53f101bb5':{name:'Exclusive',icon:'https://media.valorant-api.com/contenttiers/411e4a55-4e59-7757-41f0-86a53f101bb5/displayicon.png'}};return t[uuid]||null;}

// ===== SKIN DETAIL MODAL =====
function openSkinModal(skin, weaponName) {
    const overlay = $('#modalOverlay');
    $('#modalImage').src = skin.displayIcon || '';
    $('#modalTitle').textContent = skin.displayName;
    $('#modalWeapon').textContent = weaponName;

    // Modal favorite button
    const modalFavBtn = $('#modalFavoriteBtn');
    const fav = isFavorite(skin.uuid);
    modalFavBtn.dataset.favSkin = skin.uuid;
    modalFavBtn.classList.toggle('active', fav);
    modalFavBtn.querySelector('i').className = fav ? 'fas fa-heart' : 'far fa-heart';
    modalFavBtn.querySelector('span').textContent = fav ? 'Remove from Favorites' : 'Add to Favorites';

    // Video
    const videoSection = $('#modalVideoSection');
    const tabsContainer = $('#videoLevelTabs');
    const lvlVid = (skin.levels || []).filter(l => l.streamedVideo);
    if (lvlVid.length > 0) {
        videoSection.style.display = 'block';
        tabsContainer.innerHTML = lvlVid.map((l, i) => { const li = skin.levels.indexOf(l); const type = l.levelItem ? l.levelItem.replace('EEquippableSkinLevelItem::', '').replace(/([A-Z])/g, ' $1').trim() : ''; return `<button class="video-level-tab ${i === 0 ? 'active' : ''}" data-video-url="${l.streamedVideo}"><span class="tab-level-num">${li + 1}</span><span>${type || l.displayName || `Level ${li + 1}`}</span></button>`; }).join('');
        loadVideo(lvlVid[0].streamedVideo);
        tabsContainer.querySelectorAll('.video-level-tab').forEach(tab => { tab.addEventListener('click', () => { tabsContainer.querySelectorAll('.video-level-tab').forEach(t => t.classList.remove('active')); tab.classList.add('active'); loadVideo(tab.dataset.videoUrl); }); });
    } else { videoSection.style.display = 'none'; }

    // Chromas
    const chromasC = $('#modalChromas'), chromasG = $('#chromasGrid');
    if (skin.chromas && skin.chromas.length > 1) {
        chromasC.style.display = 'block';
        chromasG.innerHTML = skin.chromas.map((ch, i) => { const img = ch.displayIcon || ch.fullRender || skin.displayIcon || ''; const sw = ch.swatch ? `background-image:url(${ch.swatch})` : ''; return `<div class="chroma-item ${i === 0 ? 'active' : ''}" data-img="${img}">${ch.swatch ? `<div class="chroma-swatch" style="${sw};background-size:cover"></div>` : ''}<img src="${img}" alt="${ch.displayName}" loading="lazy" onerror="this.style.display='none'"><span>${ch.displayName.replace(skin.displayName, '').trim() || 'Default'}</span></div>`; }).join('');
        chromasG.querySelectorAll('.chroma-item').forEach(item => { item.addEventListener('click', () => { chromasG.querySelectorAll('.chroma-item').forEach(c => c.classList.remove('active')); item.classList.add('active'); const ni = item.dataset.img; if (ni) { const mi = $('#modalImage'); mi.style.opacity = '0'; mi.style.transform = 'scale(0.9)'; setTimeout(() => { mi.src = ni; mi.style.opacity = '1'; mi.style.transform = 'scale(1)'; }, 200); } }); });
    } else { chromasC.style.display = 'none'; }

    // Levels
    const levelsC = $('#modalLevels'), levelsL = $('#levelsList');
    if (skin.levels && skin.levels.length > 1) {
        levelsC.style.display = 'block';
        levelsL.innerHTML = skin.levels.map((l, i) => { const type = l.levelItem ? l.levelItem.replace('EEquippableSkinLevelItem::', '').replace(/([A-Z])/g, ' $1').trim() : ''; const hv = !!l.streamedVideo; return `<div class="level-item ${hv ? 'has-video' : ''}" ${hv ? `data-video="${l.streamedVideo}"` : ''}><div class="level-number">${i + 1}</div><div class="level-info"><div class="level-name">${l.displayName || `Level ${i + 1}`}</div>${type ? `<div class="level-type">${type}</div>` : ''}</div>${hv ? '<div class="level-video"><i class="fas fa-play-circle"></i></div>' : ''}</div>`; }).join('');
        levelsL.querySelectorAll('.level-item[data-video]').forEach(item => { item.addEventListener('click', () => { const url = item.dataset.video; tabsContainer.querySelectorAll('.video-level-tab').forEach(t => t.classList.toggle('active', t.dataset.videoUrl === url)); loadVideo(url); videoSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' }); }); });
    } else { levelsC.style.display = 'none'; }

    overlay.classList.add('active');
    document.body.style.overflow = 'hidden';
    $('#modalImage').style.transition = 'opacity 0.3s ease, transform 0.3s ease';
}

function closeSkinModal() { $('#modalOverlay').classList.remove('active'); document.body.style.overflow = ''; const v = $('#videoElement'); if (v) { v.pause(); v.currentTime = 0; } }

function initModals() {
    $('#modalClose').addEventListener('click', closeSkinModal);
    $('#modalOverlay').addEventListener('click', (e) => { if (e.target === $('#modalOverlay')) closeSkinModal(); });
    $('#weaponModalClose').addEventListener('click', closeWeaponModal);
    $('#weaponModalOverlay').addEventListener('click', (e) => { if (e.target === $('#weaponModalOverlay')) closeWeaponModal(); });
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { closeSkinModal(); closeWeaponModal(); } });
}

function initSmoothScroll() { $$('a[href^="#"]').forEach(a => { a.addEventListener('click', function (e) { const h = this.getAttribute('href'); if (h === '#') return; const t = document.querySelector(h); if (t) { e.preventDefault(); window.scrollTo({ top: t.getBoundingClientRect().top + window.pageYOffset - 80, behavior: 'smooth' }); } }); }); }

// ===== INIT =====
document.addEventListener('DOMContentLoaded', () => {
    initCursorGlow();
    initParticles();
    initTiltEffect();
    initGlowBorder();
    initVideoPlayer();
    initNavbar();
    initModals();
    initSmoothScroll();
    initRetryHandlers();
    initFavoriteHandlers();
    loadData();
});
